<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="schema47_001" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from version where version = 20</sqlCheck>
        </preConditions>
        <insert tableName="VERSION">
            <column name="VERSION" valueNumeric="20" />
        </insert>
        <rollback>
            <delete tableName="VERSION" >
                <where>version = 20</where>
            </delete>
        </rollback>
    </changeSet>
    <changeSet id="schema47_002" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="MEDIA_FILE" />
            </not>
        </preConditions>
        <createTable tableName="MEDIA_FILE">
            <column name="ID" type="int"/>
            <column name="PATH" type="${varchar_type}" />
            <column name="FOLDER" type="${varchar_type}" />
            <column name="TYPE" type="${varchar_type}" />
            <column name="FORMAT" type="${varchar_type}" />
            <column name="TITLE" type="${varchar_type}" />
            <column name="ALBUM" type="${varchar_type}" />
            <column name="ARTIST" type="${varchar_type}" />
            <column name="ALBUM_ARTIST" type="${varchar_type}" />
            <column name="DISC_NUMBER" type="int" />
            <column name="TRACK_NUMBER" type="int" />
            <column name="YEAR" type="int" />
            <column name="GENRE" type="${varchar_type}" />
            <column name="BIT_RATE" type="int" />
            <column name="VARIABLE_BIT_RATE" type="boolean" />
            <column name="DURATION_SECONDS" type="int" />
            <column name="FILE_SIZE" type="bigint" />
            <column name="WIDTH" type="int" />
            <column name="HEIGHT" type="int" />
            <column name="COVER_ART_PATH" type="${varchar_type}" />
            <column name="PARENT_PATH" type="${varchar_type}" />
            <column name="PLAY_COUNT" type="int" />
            <column name="LAST_PLAYED" type="datetime" />
            <column name="COMMENT" type="${varchar_type}" />
            <column name="CREATED" type="datetime" />
            <column name="CHANGED" type="datetime" />
            <column name="LAST_SCANNED" type="datetime" />
            <column name="CHILDREN_LAST_UPDATED" type="datetime" />
            <column name="PRESENT" type="boolean" />
            <column name="VERSION" type="int" />
        </createTable>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="PATH" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="TYPE" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="VARIABLE_BIT_RATE" columnDataType="boolean"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="PLAY_COUNT" columnDataType="int"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="CREATED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="CHANGED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="LAST_SCANNED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="CHILDREN_LAST_UPDATED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="PRESENT" columnDataType="boolean"/>
        <addNotNullConstraint tableName="MEDIA_FILE" columnName="VERSION" columnDataType="int"/>
        <addPrimaryKey tableName="MEDIA_FILE" columnNames="ID" />
        <addAutoIncrement tableName="MEDIA_FILE" columnName="ID" columnDataType="int" />
        <createIndex unique="true" tableName="MEDIA_FILE" indexName="idx_media_file_path">
            <column name="PATH"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_parent_path">
            <column name="PARENT_PATH"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_type">
            <column name="TYPE"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_album">
            <column name="ALBUM"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_artist">
            <column name="ARTIST"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_album_artist">
            <column name="ALBUM_ARTIST"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_present">
            <column name="PRESENT"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_genre">
            <column name="GENRE"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_play_count">
            <column name="PLAY_COUNT"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_created">
            <column name="CREATED"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_last_played">
            <column name="LAST_PLAYED"/>
        </createIndex>
        <sql dbms="hsql">
            set table media_file type cached
        </sql>
        <rollback>
            <dropTable tableName="MEDIA_FILE" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_003" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ARTIST" />
            </not>
        </preConditions>
        <createTable tableName="ARTIST">
            <column name="ID" type="int"/>
            <column name="NAME" type="${varchar_type}" />
            <column name="COVER_ART_PATH" type="${varchar_type}" />
            <column name="ALBUM_COUNT" type="int" defaultValueNumeric="0"/>
            <column name="LAST_SCANNED" type="datetime" />
            <column name="PRESENT" type="boolean" />
        </createTable>
        <addNotNullConstraint tableName="ARTIST" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="ARTIST" columnName="NAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="ARTIST" columnName="ALBUM_COUNT" columnDataType="int"/>
        <addNotNullConstraint tableName="ARTIST" columnName="LAST_SCANNED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="ARTIST" columnName="PRESENT" columnDataType="boolean"/>
        <addPrimaryKey tableName="ARTIST" columnNames="ID" />
        <addAutoIncrement tableName="ARTIST" columnName="ID" columnDataType="int" />
        <createIndex tableName="ARTIST" indexName="idx_artist_name" unique="true">
            <column name="NAME"/>
        </createIndex>
        <createIndex tableName="ARTIST" indexName="idx_artist_present" >
            <column name="PRESENT"/>
        </createIndex>
        <sql dbms="hsql">
            set table artist type cached
        </sql>
        <rollback>
            <dropTable tableName="ARTIST" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_004" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ALBUM" />
            </not>
        </preConditions>
        <createTable tableName="ALBUM">
            <column name="ID" type="int"/>
            <column name="PATH" type="${varchar_type}" />
            <column name="NAME" type="${varchar_type}" />
            <column name="ARTIST" type="${varchar_type}" />
            <column name="SONG_COUNT" type="int" defaultValueNumeric="0" />
            <column name="DURATION_SECONDS" type="int" defaultValueNumeric="0" />
            <column name="COVER_ART_PATH" type="${varchar_type}" />
            <column name="PLAY_COUNT" type="int" defaultValueNumeric="0" />
            <column name="LAST_PLAYED" type="datetime" />
            <column name="COMMENT" type="${varchar_type}" />
            <column name="CREATED" type="datetime" />
            <column name="LAST_SCANNED" type="datetime" />
            <column name="PRESENT" type="boolean" />
        </createTable>
        <addNotNullConstraint tableName="ALBUM" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="ALBUM" columnName="PATH" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="ALBUM" columnName="NAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="ALBUM" columnName="ARTIST" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="ALBUM" columnName="SONG_COUNT" columnDataType="int"/>
        <addNotNullConstraint tableName="ALBUM" columnName="DURATION_SECONDS" columnDataType="int"/>
        <addNotNullConstraint tableName="ALBUM" columnName="PLAY_COUNT" columnDataType="int"/>
        <addNotNullConstraint tableName="ALBUM" columnName="CREATED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="ALBUM" columnName="LAST_SCANNED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="ALBUM" columnName="PRESENT" columnDataType="boolean"/>
        <addPrimaryKey tableName="ALBUM" columnNames="ID" />
        <addAutoIncrement tableName="ALBUM" columnName="ID" columnDataType="int" />
        <createIndex tableName="ALBUM" indexName="idx_album_artist_name" unique="true">
            <column name="ARTIST" />
            <column name="NAME"/>
        </createIndex>
        <createIndex tableName="ALBUM" indexName="idx_album_play_count" >
            <column name="PLAY_COUNT"/>
        </createIndex>
        <createIndex tableName="ALBUM" indexName="idx_album_last_played" >
            <column name="LAST_PLAYED"/>
        </createIndex>
        <createIndex tableName="ALBUM" indexName="idx_album_present" >
            <column name="PRESENT"/>
        </createIndex>
        <sql dbms="hsql">
            set table album type cached
        </sql>
        <rollback>
            <dropTable tableName="ALBUM" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_005" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="idx_album_name" />
            </not>
        </preConditions>
        <createIndex tableName="ALBUM" indexName="idx_album_name">
            <column name="NAME"/>
        </createIndex>
    </changeSet>
    <changeSet id="schema47_006" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STARRED_MEDIA_FILE" />
            </not>
        </preConditions>
        <createTable tableName="STARRED_MEDIA_FILE">
            <column name="ID" type="int"/>
            <column name="MEDIA_FILE_ID" type="int" />
            <column name="USERNAME" type="${varchar_type}" />
            <column name="CREATED" type="datetime" />
        </createTable>
        <addNotNullConstraint tableName="STARRED_MEDIA_FILE" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="STARRED_MEDIA_FILE" columnName="MEDIA_FILE_ID" columnDataType="int"/>
        <addNotNullConstraint tableName="STARRED_MEDIA_FILE" columnName="USERNAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="STARRED_MEDIA_FILE" columnName="CREATED" columnDataType="datetime"/>
        <addPrimaryKey tableName="STARRED_MEDIA_FILE" columnNames="ID" />
        <addAutoIncrement tableName="STARRED_MEDIA_FILE" columnName="ID" columnDataType="int" />
        <createIndex tableName="STARRED_MEDIA_FILE" indexName="idx_starred_media_file_media_file_id">
            <column name="MEDIA_FILE_ID"/>
        </createIndex>
        <createIndex tableName="STARRED_MEDIA_FILE" indexName="idx_starred_media_file_username">
            <column name="USERNAME"/>
        </createIndex>
        <addForeignKeyConstraint baseTableName="STARRED_MEDIA_FILE"
                                 baseColumnNames="MEDIA_FILE_ID"
                                 constraintName="smf_mf_fk"
                                 referencedTableName="MEDIA_FILE"
                                 referencedColumnNames="ID"
                                 onDelete="CASCADE"/>
        <addForeignKeyConstraint baseTableName="STARRED_MEDIA_FILE"
                                 baseColumnNames="USERNAME"
                                 constraintName="smf_u_fk"
                                 referencedTableName="USER"
                                 referencedColumnNames="USERNAME"
                                 onDelete="CASCADE" />
        <addUniqueConstraint tableName="STARRED_MEDIA_FILE" columnNames="MEDIA_FILE_ID,USERNAME" />
        <rollback>
            <dropTable tableName="STARRED_MEDIA_FILE" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_007" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STARRED_ALBUM" />
            </not>
        </preConditions>
        <createTable tableName="STARRED_ALBUM">
            <column name="ID" type="int"/>
            <column name="ALBUM_ID" type="int" />
            <column name="USERNAME" type="${varchar_type}" />
            <column name="CREATED" type="datetime" />
        </createTable>
        <addNotNullConstraint tableName="STARRED_ALBUM" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="STARRED_ALBUM" columnName="ALBUM_ID" columnDataType="int"/>
        <addNotNullConstraint tableName="STARRED_ALBUM" columnName="USERNAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="STARRED_ALBUM" columnName="CREATED" columnDataType="datetime"/>
        <addPrimaryKey tableName="STARRED_ALBUM" columnNames="ID" />
        <addAutoIncrement tableName="STARRED_ALBUM" columnName="ID" columnDataType="int" />
        <createIndex tableName="STARRED_ALBUM" indexName="idx_starred_album_album_id">
            <column name="ALBUM_ID"/>
        </createIndex>
        <createIndex tableName="STARRED_ALBUM" indexName="idx_starred_album_username">
            <column name="USERNAME"/>
        </createIndex>
        <addForeignKeyConstraint baseTableName="STARRED_ALBUM"
                                 baseColumnNames="ALBUM_ID"
                                 constraintName="sa_a_fk"
                                 referencedTableName="ALBUM"
                                 referencedColumnNames="ID"
                                 onDelete="CASCADE"/>
        <addForeignKeyConstraint baseTableName="STARRED_ALBUM"
                                 baseColumnNames="USERNAME"
                                 constraintName="sa_u_fk"
                                 referencedTableName="USER"
                                 referencedColumnNames="USERNAME"
                                 onDelete="CASCADE" />
        <addUniqueConstraint tableName="STARRED_ALBUM" columnNames="ALBUM_ID,USERNAME" />
        <rollback>
            <dropTable tableName="STARRED_ALBUM" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_008" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STARRED_ARTIST" />
            </not>
        </preConditions>
        <createTable tableName="STARRED_ARTIST">
            <column name="ID" type="int"/>
            <column name="ARTIST_ID" type="int"/>
            <column name="USERNAME" type="${varchar_type}" />
            <column name="CREATED" type="datetime" />
        </createTable>
        <addNotNullConstraint tableName="STARRED_ARTIST" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="STARRED_ARTIST" columnName="ARTIST_ID" columnDataType="int"/>
        <addNotNullConstraint tableName="STARRED_ARTIST" columnName="USERNAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="STARRED_ARTIST" columnName="CREATED" columnDataType="datetime"/>
        <addPrimaryKey tableName="STARRED_ARTIST" columnNames="ID" />
        <addAutoIncrement tableName="STARRED_ARTIST" columnName="ID" columnDataType="int"/>
        <createIndex tableName="STARRED_ARTIST" indexName="idx_starred_artist_artist_id">
            <column name="ARTIST_ID"/>
        </createIndex>
        <createIndex tableName="STARRED_ARTIST" indexName="idx_starred_artist_username">
            <column name="USERNAME"/>
        </createIndex>
        <addForeignKeyConstraint baseTableName="STARRED_ARTIST"
                                 baseColumnNames="ARTIST_ID"
                                 constraintName="sar_a_fk"
                                 referencedTableName="ARTIST"
                                 referencedColumnNames="ID"
                                 onDelete="CASCADE"/>
        <addForeignKeyConstraint baseTableName="STARRED_ARTIST"
                                 baseColumnNames="USERNAME"
                                 constraintName="sar_u_fk"
                                 referencedTableName="USER"
                                 referencedColumnNames="USERNAME"
                                 onDelete="CASCADE" />
        <addUniqueConstraint tableName="STARRED_ARTIST" columnNames="ARTIST_ID,USERNAME" />
        <rollback>
            <dropTable tableName="STARRED_ARTIST" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_009" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYLIST" />
            </not>
        </preConditions>
        <createTable tableName="PLAYLIST">
            <column name="ID" type="int"/>
            <column name="USERNAME" type="${varchar_type}" />
            <column name="IS_PUBLIC" type="boolean" />
            <column name="NAME" type="${varchar_type}" />
            <column name="COMMENT" type="${varchar_type}" />
            <column name="FILE_COUNT" type="int" defaultValueNumeric="0"/>
            <column name="DURATION_SECONDS" type="int" defaultValueNumeric="0" />
            <column name="CREATED" type="datetime" />
            <column name="CHANGED" type="datetime" />
        </createTable>
        <addNotNullConstraint tableName="PLAYLIST" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYLIST" columnName="USERNAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="PLAYLIST" columnName="IS_PUBLIC" columnDataType="boolean"/>
        <addNotNullConstraint tableName="PLAYLIST" columnName="NAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="PLAYLIST" columnName="FILE_COUNT" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYLIST" columnName="DURATION_SECONDS" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYLIST" columnName="CREATED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="PLAYLIST" columnName="CHANGED" columnDataType="datetime"/>
        <addPrimaryKey tableName="PLAYLIST" columnNames="ID" />
        <addAutoIncrement tableName="PLAYLIST" columnName="ID" columnDataType="int"/>
        <addForeignKeyConstraint baseTableName="PLAYLIST"
                                 baseColumnNames="USERNAME"
                                 constraintName="p_u_fk"
                                 referencedTableName="USER"
                                 referencedColumnNames="USERNAME"
                                 onDelete="CASCADE"/>
        <rollback>
            <dropTable tableName="PLAYLIST" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_010" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="PLAYLIST" columnName="IMPORTED_FROM" />
            </not>
        </preConditions>
        <addColumn tableName="PLAYLIST">
            <column name="IMPORTED_FROM" type="${varchar_type}"/>
        </addColumn>
    </changeSet>
    <changeSet id="schema47_011" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYLIST_FILE" />
            </not>
        </preConditions>
        <createTable tableName="PLAYLIST_FILE">
            <column name="ID" type="int"/>
            <column name="PLAYLIST_ID" type="int" />
            <column name="MEDIA_FILE_ID" type="int" />
        </createTable>
        <addNotNullConstraint tableName="PLAYLIST_FILE" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYLIST_FILE" columnName="PLAYLIST_ID" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYLIST_FILE" columnName="MEDIA_FILE_ID" columnDataType="int"/>
        <addPrimaryKey tableName="PLAYLIST_FILE" columnNames="ID" />
        <addAutoIncrement tableName="PLAYLIST_FILE" columnName="ID" columnDataType="int" />
        <addForeignKeyConstraint baseTableName="PLAYLIST_FILE"
                                 baseColumnNames="PLAYLIST_ID"
                                 constraintName="pf_p_fk"
                                 referencedTableName="PLAYLIST"
                                 referencedColumnNames="ID"
                                 onDelete="CASCADE" />
        <addForeignKeyConstraint baseTableName="PLAYLIST_FILE"
                                 baseColumnNames="MEDIA_FILE_ID"
                                 constraintName="pf_mf_fk"
                                 referencedTableName="MEDIA_FILE"
                                 referencedColumnNames="ID"
                                 onDelete="CASCADE" />

        <sql dbms="hsql">
            set table playlist_file type cached
        </sql>
        <rollback>
            <dropTable tableName="PLAYLIST_FILE" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_012" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYLIST_USER" />
            </not>
        </preConditions>
        <createTable tableName="PLAYLIST_USER">
            <column name="ID" type="int"/>
            <column name="PLAYLIST_ID" type="int" />
            <column name="USERNAME" type="${varchar_type}" />
        </createTable>
        <addNotNullConstraint tableName="PLAYLIST_USER" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYLIST_USER" columnName="PLAYLIST_ID" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYLIST_USER" columnName="USERNAME" columnDataType="${varchar_type}"/>
        <addPrimaryKey tableName="PLAYLIST_USER" columnNames="ID" />
        <addAutoIncrement tableName="PLAYLIST_USER" columnName="ID" columnDataType="int"/>
        <addUniqueConstraint tableName="PLAYLIST_USER" columnNames="PLAYLIST_ID,USERNAME" />
        <addForeignKeyConstraint baseTableName="PLAYLIST_USER"
                                 baseColumnNames="PLAYLIST_ID"
                                 constraintName="pu_p_fk"
                                 referencedTableName="PLAYLIST"
                                 referencedColumnNames="ID"
                                 onDelete="CASCADE" />
        <addForeignKeyConstraint baseTableName="PLAYLIST_USER"
                                 baseColumnNames="USERNAME"
                                 constraintName="pu_u_fk"
                                 referencedTableName="USER"
                                 referencedColumnNames="USERNAME"
                                 onDelete="CASCADE" />
        <rollback>
            <dropTable tableName="PLAYLIST_USER" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_013" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="BOOKMARK" />
            </not>
        </preConditions>
        <createTable tableName="BOOKMARK">
            <column name="ID" type="int"/>
            <column name="MEDIA_FILE_ID" type="int" />
            <column name="POSITION_MILLIS" type="bigint" />
            <column name="USERNAME" type="${varchar_type}" />
            <column name="COMMENT" type="${varchar_type}" />
            <column name="CREATED" type="datetime" />
            <column name="CHANGED" type="datetime" />
        </createTable>
        <addNotNullConstraint tableName="BOOKMARK" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="BOOKMARK" columnName="MEDIA_FILE_ID" columnDataType="int"/>
        <addNotNullConstraint tableName="BOOKMARK" columnName="POSITION_MILLIS" columnDataType="bigint"/>
        <addNotNullConstraint tableName="BOOKMARK" columnName="USERNAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="BOOKMARK" columnName="CREATED" columnDataType="datetime"/>
        <addNotNullConstraint tableName="BOOKMARK" columnName="CHANGED" columnDataType="datetime"/>
        <addPrimaryKey tableName="BOOKMARK" columnNames="ID" />
        <addAutoIncrement tableName="BOOKMARK" columnName="ID" columnDataType="int"/>
        <createIndex tableName="BOOKMARK" indexName="idx_bookmark_media_file_id">
            <column name="MEDIA_FILE_ID"/>
        </createIndex>
        <createIndex tableName="BOOKMARK" indexName="idx_bookmark_username">
            <column name="USERNAME"/>
        </createIndex>
        <addUniqueConstraint columnNames="MEDIA_FILE_ID,USERNAME" tableName="BOOKMARK" />
        <addForeignKeyConstraint baseTableName="BOOKMARK"
                                 baseColumnNames="USERNAME"
                                 constraintName="b_u_fk"
                                 referencedTableName="USER"
                                 referencedColumnNames="USERNAME"
                                 onDelete="CASCADE"/>
        <addForeignKeyConstraint baseTableName="BOOKMARK"
                                 baseColumnNames="MEDIA_FILE_ID"
                                 constraintName="b_mf_fk"
                                 referencedTableName="MEDIA_FILE"
                                 referencedColumnNames="ID"
                                 onDelete="CASCADE"/>
        <rollback>
            <dropTable tableName="BOOKMARK" />
        </rollback>
    </changeSet>
</databaseChangeLog>
