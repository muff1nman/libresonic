<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="schema26_001" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from version where version = 2</sqlCheck>
        </preConditions>
        <insert tableName="VERSION">
            <column name="VERSION" valueNumeric="2" />
        </insert>
        <rollback>
            <delete tableName="VERSION" >
                <where>version = 2</where>
            </delete>
        </rollback>
    </changeSet>
    <changeSet id="schema26_002" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="MUSIC_FOLDER" />
            </not>
        </preConditions>
        <createTable tableName="MUSIC_FOLDER">
            <column name="ID" type="int" autoIncrement="true" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="PATH" type="${varchar_type}" />
            <column name="NAME" type="${varchar_type}" />
            <column name="ENABLED" type="boolean" />
        </createTable>
        <addNotNullConstraint tableName="MUSIC_FOLDER" columnName="PATH" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="MUSIC_FOLDER" columnName="NAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="MUSIC_FOLDER" columnName="ENABLED" columnDataType="boolean"/>
        <insert tableName="MUSIC_FOLDER">
            <column name="PATH" value="${defaultMusicFolder}"/>
            <column name="NAME" value="Music"/>
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <rollback>
            <dropTable tableName="MUSIC_FOLDER" />
        </rollback>
    </changeSet>
    <changeSet id="schema26_003" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="MUSIC_FILE_INFO" />
            </not>
        </preConditions>
        <createTable tableName="MUSIC_FILE_INFO">
            <column name="ID" type="int"/>
            <column name="PATH" type="${varchar_type}" />
            <column name="RATING" type="int" />
            <column name="COMMENT" type="${varchar_type}" />
            <column name="PLAY_COUNT" type="int" />
            <column name="LAST_PLAYED" type="datetime" />
        </createTable>
        <addPrimaryKey tableName="MUSIC_FILE_INFO" columnNames="ID" />
        <addAutoIncrement tableName="MUSIC_FILE_INFO" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="MUSIC_FILE_INFO" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="MUSIC_FILE_INFO" columnName="PATH" columnDataType="${varchar_type}"/>
        <createIndex tableName="MUSIC_FILE_INFO" indexName="idx_music_file_info_path">
            <column name="PATH"/>
        </createIndex>
        <rollback>
            <dropTable tableName="MUSIC_FILE_INFO" />
        </rollback>
    </changeSet>
    <changeSet id="schema26_004" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="INTERNET_RADIO" />
            </not>
        </preConditions>
        <createTable tableName="INTERNET_RADIO">
            <column name="ID" type="int"/>
            <column name="NAME" type="${varchar_type}" />
            <column name="STREAM_URL" type="${varchar_type}" />
            <column name="HOMEPAGE_URL" type="${varchar_type}" />
            <column name="ENABLED" type="boolean" />
        </createTable>
        <addPrimaryKey tableName="INTERNET_RADIO" columnNames="ID" />
        <addNotNullConstraint tableName="INTERNET_RADIO" columnName="ID" columnDataType="int"/>
        <addAutoIncrement tableName="INTERNET_RADIO" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="INTERNET_RADIO" columnName="NAME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="INTERNET_RADIO" columnName="STREAM_URL" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="INTERNET_RADIO" columnName="ENABLED" columnDataType="boolean"/>
        <rollback>
            <dropTable tableName="INTERNET_RADIO" />
        </rollback>
    </changeSet>
    <changeSet id="schema26_005" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYER" />
            </not>
        </preConditions>
        <createTable tableName="PLAYER">
            <column name="ID" type="int"/>
            <column name="NAME" type="${varchar_type}" />
            <column name="TYPE" type="${varchar_type}" />
            <column name="USERNAME" type="${varchar_type}" />
            <column name="IP_ADDRESS" type="${varchar_type}" />
            <column name="AUTO_CONTROL_ENABLED" type="boolean" />
            <column name="LAST_SEEN" type="datetime" />
            <column name="COVER_ART_SCHEME" type="${varchar_type}" />
            <column name="TRANSCODE_SCHEME" type="${varchar_type}" />
        </createTable>
        <addPrimaryKey tableName="PLAYER" columnNames="ID" />
        <addNotNullConstraint tableName="PLAYER" columnName="ID" columnDataType="int"/>
        <addNotNullConstraint tableName="PLAYER" columnName="AUTO_CONTROL_ENABLED" columnDataType="boolean"/>
        <addNotNullConstraint tableName="PLAYER" columnName="COVER_ART_SCHEME" columnDataType="${varchar_type}"/>
        <addNotNullConstraint tableName="PLAYER" columnName="TRANSCODE_SCHEME" columnDataType="${varchar_type}"/>
        <rollback>
            <dropTable tableName="PLAYER" />
        </rollback>
    </changeSet>
    <changeSet id="schema26_006" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="PLAYER" columnName="DYNAMIC_IP" />
            </not>
        </preConditions>
        <addColumn tableName="PLAYER">
            <column name="DYNAMIC_IP" type="boolean" defaultValueBoolean="true"/>
        </addColumn>
        <addNotNullConstraint tableName="PLAYER" columnName="DYNAMIC_IP" columnDataType="boolean"/>
        <rollback>
            <dropColumn tableName="PLAYER" columnName="DYNAMIC_IP"/>
        </rollback>
    </changeSet>
    <changeSet id="schema26_007" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from role where id = 6</sqlCheck>
        </preConditions>
        <insert tableName="ROLE">
            <column name="ID" valueNumeric="6"/>
            <column name="NAME" value="comment" />
        </insert>
        <sql>
            insert into "USER_ROLE"(username, role_id)
            select distinct u.username, 6 from "USER" u, "USER_ROLE" ur
            where u.username = ur.username and ur.role_id in (1, 5)
        </sql>
        <rollback>
            <delete tableName="USER_ROLE" >
                <where>role_id = 6</where>
            </delete>
            <delete tableName="ROLE">
                <where>id = 6</where>
            </delete>
        </rollback>
    </changeSet>
</databaseChangeLog>
