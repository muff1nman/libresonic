<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="schema28_001" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from version where version = 4</sqlCheck>
        </preConditions>
        <insert tableName="VERSION">
            <column name="VERSION" valueNumeric="4" />
        </insert>
        <rollback>
            <delete tableName="VERSION" >
                <where>version = 4</where>
            </delete>
        </rollback>
    </changeSet>
    <changeSet id="schema28_002" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="USER_SETTINGS" />
            </not>
        </preConditions>
        <createTable tableName="USER_SETTINGS">
            <column name="USERNAME" type="${varchar_type}">
                <constraints primaryKey="true" foreignKeyName="us_u_fk" referencedTableName="USER" referencedColumnNames="USERNAME" deleteCascade="true"/>
            </column>
            <column name="LOCALE" type="${varchar_type}" />
            <column name="THEME_ID" type="${varchar_type}" />
            <column name="FINAL_VERSION_NOTIFICATION" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="BETA_VERSION_NOTIFICATION" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_CAPTION_CUTOFF" type="int" defaultValueNumeric="35" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_TRACK_NUMBER" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_ARTIST" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_ALBUM" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_GENRE" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_YEAR" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_BIT_RATE" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_DURATION" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_FORMAT" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="MAIN_FILE_SIZE" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_CAPTION_CUTOFF" type="int" defaultValueNumeric="35" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_TRACK_NUMBER" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_ARTIST" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_ALBUM" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_GENRE" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_YEAR" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_BIT_RATE" type="boolean" defaultValueBoolean="false" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_DURATION" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_FORMAT" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
            <column name="PLAYLIST_FILE_SIZE" type="boolean" defaultValueBoolean="true" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <rollback>
            <dropTable tableName="USER_SETTINGS" />
        </rollback>
    </changeSet>
    <changeSet id="schema28_003" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="TRANSCODING" />
            </not>
        </preConditions>
        <createTable tableName="TRANSCODING">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="NAME" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="SOURCE_FORMAT" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="TARGET_FORMAT" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="STEP1" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="STEP2" type="${varchar_type}" />
            <column name="STEP3" type="${varchar_type}" />
            <column name="ENABLED" type="boolean" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="wav > mp3"/>
            <column name="SOURCE_FORMAT" value="wav" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="flac > mp3"/>
            <column name="SOURCE_FORMAT" value="flac" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="ogg > mp3"/>
            <column name="SOURCE_FORMAT" value="ogg" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="wma > mp3"/>
            <column name="SOURCE_FORMAT" value="wma" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="m4a > mp3"/>
            <column name="SOURCE_FORMAT" value="m4a" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="false" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="aac > mp3"/>
            <column name="SOURCE_FORMAT" value="aac" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="false" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="ape > mp3"/>
            <column name="SOURCE_FORMAT" value="ape" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="mpc > mp3"/>
            <column name="SOURCE_FORMAT" value="mpc" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="mv > mp3"/>
            <column name="SOURCE_FORMAT" value="mv" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <insert tableName="TRANSCODING">
            <column name="NAME" value="shn > mp3"/>
            <column name="SOURCE_FORMAT" value="shn" />
            <column name="TARGET_FORMAT" value="mp3"/>
            <column name="STEP1" value="ffmpeg -i %s -v 0 -f wav -" />
            <column name="STEP2" value="lame -b %b --tt %t --ta %a --tl %l -S --resample 44.1 - -" />
            <column name="ENABLED" valueBoolean="true" />
        </insert>
        <rollback>
            <dropTable tableName="TRANSCODING" />
        </rollback>
    </changeSet>
    <changeSet id="schema28_004" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYER_TRANSCODING" />
            </not>
        </preConditions>
        <createTable tableName="PLAYER_TRANSCODING">
            <column name="PLAYER_ID" type="int">
                <constraints nullable="false" foreignKeyName="pt_p_fk" referencedTableName="PLAYER" referencedColumnNames="ID" deleteCascade="true"/>
            </column>
            <column name="TRANSCODING_ID" type="int" >
                <constraints nullable="false" foreignKeyName="pt_t_fk" referencedTableName="TRANSCODING" referencedColumnNames="ID" deleteCascade="true"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="PLAYER_TRANSCODING" columnNames="PLAYER_ID,TRANSCODING_ID" />
        <rollback>
            <dropTable tableName="PLAYER_TRANSCODING" />
        </rollback>
    </changeSet>
</databaseChangeLog>
