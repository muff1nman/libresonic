<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="schema47_001" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from VERSION where VERSION = 20</sqlCheck>
        </preConditions>
        <insert tableName="VERSION">
            <column name="VERSION" valueNumeric="20" />
        </insert>
        <rollback>
            <delete tableName="VERSION" >
                <where>VERSION = 20</where>
            </delete>
        </rollback>
    </changeSet>
    <changeSet id="schema47_002" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="MEDIA_FILE" />
            </not>
        </preConditions>
        <createTable tableName="MEDIA_FILE">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="PATH" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="FOLDER" type="${varchar_type}" />
            <column name="TYPE" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="FORMAT" type="${varchar_type}" />
            <column name="TITLE" type="${varchar_type}" />
            <column name="ALBUM" type="${varchar_type}" />
            <column name="ARTIST" type="${varchar_type}" />
            <column name="ALBUM_ARTIST" type="${varchar_type}" />
            <column name="DISC_NUMBER" type="int" />
            <column name="TRACK_NUMBER" type="int" />
            <column name="YEAR" type="int" />
            <column name="GENRE" type="${varchar_type}" />
            <column name="BIT_RATE" type="int" />
            <column name="VARIABLE_BIT_RATE" type="boolean" >
                <constraints nullable="false" />
            </column>
            <column name="DURATION_SECONDS" type="int" />
            <column name="FILE_SIZE" type="bigint" />
            <column name="WIDTH" type="int" />
            <column name="HEIGHT" type="int" />
            <column name="COVER_ART_PATH" type="${varchar_type}" />
            <column name="PARENT_PATH" type="${varchar_type}" />
            <column name="PLAY_COUNT" type="int" >
                <constraints nullable="false" />
            </column>
            <column name="LAST_PLAYED" type="datetime" />
            <column name="COMMENT" type="${varchar_type}" />
            <column name="CREATED" type="datetime" >
                <constraints nullable="false" />
            </column>
            <column name="CHANGED" type="datetime" >
                <constraints nullable="false" />
            </column>
            <column name="LAST_SCANNED" type="datetime" >
                <constraints nullable="false" />
            </column>
            <column name="CHILDREN_LAST_UPDATED" type="datetime" >
                <constraints nullable="false" />
            </column>
            <column name="PRESENT" type="boolean" >
                <constraints nullable="false" />
            </column>
            <column name="VERSION" type="int" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <createIndex unique="true" tableName="MEDIA_FILE" indexName="idx_media_file_path">
            <column name="PATH"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_parent_path">
            <column name="PARENT_PATH"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_type">
            <column name="TYPE"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_album">
            <column name="ALBUM"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_artist">
            <column name="ARTIST"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_album_artist">
            <column name="ALBUM_ARTIST"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_present">
            <column name="PRESENT"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_genre">
            <column name="GENRE"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_play_count">
            <column name="PLAY_COUNT"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_created">
            <column name="CREATED"/>
        </createIndex>
        <createIndex tableName="MEDIA_FILE" indexName="idx_media_file_last_played">
            <column name="LAST_PLAYED"/>
        </createIndex>
        <sql dbms="hsql">
            set table media_file type cached
        </sql>
        <rollback>
            <dropTable tableName="MEDIA_FILE" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_003" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ARTIST" />
            </not>
        </preConditions>
        <createTable tableName="ARTIST">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="NAME" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="COVER_ART_PATH" type="${varchar_type}" />
            <column name="ALBUM_COUNT" type="int" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="LAST_SCANNED" type="datetime" >
                <constraints nullable="false" />
            </column>
            <column name="PRESENT" type="boolean" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <createIndex tableName="ARTIST" indexName="idx_artist_name" unique="true">
            <column name="NAME"/>
        </createIndex>
        <createIndex tableName="ARTIST" indexName="idx_artist_present" >
            <column name="PRESENT"/>
        </createIndex>
        <sql dbms="hsql">
            set table artist type cached
        </sql>
        <rollback>
            <dropTable tableName="ARTIST" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_004" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ALBUM" />
            </not>
        </preConditions>
        <createTable tableName="ALBUM">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="PATH" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="NAME" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="ARTIST" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="SONG_COUNT" type="int" defaultValueNumeric="0" >
                <constraints nullable="false" />
            </column>
            <column name="DURATION_SECONDS" type="int" defaultValueNumeric="0" >
                <constraints nullable="false" />
            </column>
            <column name="COVER_ART_PATH" type="${varchar_type}" />
            <column name="PLAY_COUNT" type="int" defaultValueNumeric="0" >
                <constraints nullable="false" />
            </column>
            <column name="LAST_PLAYED" type="datetime" />
            <column name="COMMENT" type="${varchar_type}" />
            <column name="CREATED" type="datetime" />
            <column name="LAST_SCANNED" type="datetime" />
            <column name="PRESENT" type="boolean" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <createIndex tableName="ALBUM" indexName="idx_album_artist_name" unique="true">
            <column name="ARTIST" />
            <column name="NAME"/>
        </createIndex>
        <createIndex tableName="ALBUM" indexName="idx_album_play_count" >
            <column name="PLAY_COUNT"/>
        </createIndex>
        <createIndex tableName="ALBUM" indexName="idx_album_last_played" >
            <column name="LAST_PLAYED"/>
        </createIndex>
        <createIndex tableName="ALBUM" indexName="idx_album_present" >
            <column name="PRESENT"/>
        </createIndex>
        <sql dbms="hsql">
            set table album type cached
        </sql>
        <rollback>
            <dropTable tableName="ALBUM" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_005" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="idx_album_name" />
            </not>
        </preConditions>
        <createIndex tableName="ALBUM" indexName="idx_album_name">
            <column name="NAME"/>
        </createIndex>
    </changeSet>
    <changeSet id="schema47_006" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STARRED_MEDIA_FILE" />
            </not>
        </preConditions>
        <createTable tableName="STARRED_MEDIA_FILE">
            <column name="ID" type="int" autoIncrement="true">
                <constraints nullable="false" />
            </column>
            <column name="MEDIA_FILE_ID" type="int" >
                <constraints nullable="false" foreignKeyName="smf_mf_fk" referencedTableName="MEDIA_FILE" referencedColumnNames="ID" deleteCascade="true" />
            </column>
            <column name="USERNAME" type="${varchar_type}" >
                <constraints nullable="false" foreignKeyName="smf_u_fk" referencedTableName="USER" referencedColumnNames="USERNAME" deleteCascade="true" />
            </column>
            <column name="CREATED" type="datetime" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <createIndex tableName="STARRED_MEDIA_FILE" indexName="idx_starred_media_file_media_file_id">
            <column name="MEDIA_FILE_ID"/>
        </createIndex>
        <createIndex tableName="STARRED_MEDIA_FILE" indexName="idx_starred_media_file_username">
            <column name="USERNAME"/>
        </createIndex>
        <addUniqueConstraint tableName="STARRED_MEDIA_FILE" columnNames="MEDIA_FILE_ID,USERNAME" />
        <rollback>
            <dropTable tableName="STARRED_MEDIA_FILE" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_007" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STARRED_ALBUM" />
            </not>
        </preConditions>
        <createTable tableName="STARRED_ALBUM">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="ALBUM_ID" type="int" >
                <constraints nullable="false" foreignKeyName="sa_a_fk" referencedTableName="ALBUM" referencedColumnNames="ID" deleteCascade="true" />
            </column>
            <column name="USERNAME" type="${varchar_type}" >
                <constraints nullable="false" foreignKeyName="sa_u_fk" referencedTableName="USER" referencedColumnNames="USERNAME" deleteCascade="true" />
            </column>
            <column name="CREATED" type="datetime" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <createIndex tableName="STARRED_ALBUM" indexName="idx_starred_album_album_id">
            <column name="ALBUM_ID"/>
        </createIndex>
        <createIndex tableName="STARRED_ALBUM" indexName="idx_starred_album_username">
            <column name="USERNAME"/>
        </createIndex>
        <addUniqueConstraint tableName="STARRED_ALBUM" columnNames="ALBUM_ID,USERNAME" />
        <rollback>
            <dropTable tableName="STARRED_ALBUM" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_008" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STARRED_ARTIST" />
            </not>
        </preConditions>
        <createTable tableName="STARRED_ARTIST">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="ARTIST_ID" type="int">
                <constraints nullable="false" foreignKeyName="sar_a_fk" referencedTableName="ARTIST" referencedColumnNames="ID" deleteCascade="true" />
            </column>
            <column name="USERNAME" type="${varchar_type}" >
                <constraints nullable="false" foreignKeyName="sar_u_fk" referencedTableName="USER" referencedColumnNames="USERNAME" deleteCascade="true" />
            </column>
            <column name="CREATED" type="datetime" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <createIndex tableName="STARRED_ARTIST" indexName="idx_starred_artist_artist_id">
            <column name="ARTIST_ID"/>
        </createIndex>
        <createIndex tableName="STARRED_ARTIST" indexName="idx_starred_artist_username">
            <column name="USERNAME"/>
        </createIndex>
        <addUniqueConstraint tableName="STARRED_ARTIST" columnNames="ARTIST_ID,USERNAME" />
        <rollback>
            <dropTable tableName="STARRED_ARTIST" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_009" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYLIST" />
            </not>
        </preConditions>
        <createTable tableName="PLAYLIST">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="USERNAME" type="${varchar_type}" >
                <constraints nullable="false" foreignKeyName="p_u_fk" referencedTableName="USER" referencedColumnNames="USERNAME" deleteCascade="true" />
            </column>
            <column name="IS_PUBLIC" type="boolean" >
                <constraints nullable="false" />
            </column>
            <column name="NAME" type="${varchar_type}" >
                <constraints nullable="false" />
            </column>
            <column name="COMMENT" type="${varchar_type}" />
            <column name="FILE_COUNT" type="int" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="DURATION_SECONDS" type="int" defaultValueNumeric="0" >
                <constraints nullable="false" />
            </column>
            <column name="CREATED" type="datetime" >
                <constraints nullable="false" />
            </column>
            <column name="CHANGED" type="datetime" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <rollback>
            <dropTable tableName="PLAYLIST" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_010" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="PLAYLIST" columnName="IMPORTED_FROM" />
            </not>
        </preConditions>
        <addColumn tableName="PLAYLIST">
            <column name="IMPORTED_FROM" type="${varchar_type}"/>
        </addColumn>
    </changeSet>
    <changeSet id="schema47_011" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYLIST_FILE" />
            </not>
        </preConditions>
        <createTable tableName="PLAYLIST_FILE">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="PLAYLIST_ID" type="int" >
                <constraints nullable="false" foreignKeyName="pf_p_fk" referencedTableName="PLAYLIST" referencedColumnNames="ID" deleteCascade="true" />
            </column>
            <column name="MEDIA_FILE_ID" type="int" >
                <constraints nullable="false" foreignKeyName="pf_mf_fk" referencedTableName="MEDIA_FILE" referencedColumnNames="ID" deleteCascade="true" />
            </column>
        </createTable>
        <sql dbms="hsql">
            set table playlist_file type cached
        </sql>
        <rollback>
            <dropTable tableName="PLAYLIST_FILE" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_012" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PLAYLIST_USER" />
            </not>
        </preConditions>
        <createTable tableName="PLAYLIST_USER">
            <column name="ID" type="int" autoIncrement="true" >
                <constraints primaryKey="true" />
            </column>
            <column name="PLAYLIST_ID" type="int" >
                <constraints nullable="false" foreignKeyName="pu_p_fk" referencedTableName="PLAYLIST" referencedColumnNames="ID" deleteCascade="true" />
            </column>
            <column name="USERNAME" type="${varchar_type}" >
                <constraints nullable="false" foreignKeyName="pu_u_fk" referencedTableName="USER" referencedColumnNames="USERNAME" deleteCascade="true" />
            </column>
        </createTable>
        <addUniqueConstraint tableName="PLAYLIST_USER" columnNames="PLAYLIST_ID,USERNAME" />
        <rollback>
            <dropTable tableName="PLAYLIST_USER" />
        </rollback>
    </changeSet>
    <changeSet id="schema47_013" author="muff1nman">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="BOOKMARK" />
            </not>
        </preConditions>
        <createTable tableName="BOOKMARK">
            <column name="ID" type="int" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="MEDIA_FILE_ID" type="int" >
                <constraints nullable="false" foreignKeyName="b_mf_fk" referencedTableName="MEDIA_FILE" referencedColumnNames="ID" deleteCascade="true" />
            </column>
            <column name="POSITION_MILLIS" type="bigint" >
                <constraints nullable="false" />
            </column>
            <column name="USERNAME" type="${varchar_type}" >
                <constraints nullable="false" foreignKeyName="b_u_fk" referencedTableName="USER" referencedColumnNames="USERNAME" deleteCascade="true" />
            </column>
            <column name="COMMENT" type="${varchar_type}" />
            <column name="CREATED" type="datetime" >
                <constraints nullable="false" />
            </column>
            <column name="CHANGED" type="datetime" >
                <constraints nullable="false" />
            </column>
        </createTable>
        <createIndex tableName="BOOKMARK" indexName="idx_bookmark_media_file_id">
            <column name="MEDIA_FILE_ID"/>
        </createIndex>
        <createIndex tableName="BOOKMARK" indexName="idx_bookmark_username">
            <column name="USERNAME"/>
        </createIndex>
        <addUniqueConstraint columnNames="MEDIA_FILE_ID,USERNAME" tableName="BOOKMARK" />
        <rollback>
            <dropTable tableName="BOOKMARK" />
        </rollback>
    </changeSet>
</databaseChangeLog>
